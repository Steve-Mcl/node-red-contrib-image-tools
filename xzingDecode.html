<style>
.node-label-white{
    color: white;
}
</style>
<script type="text/javascript">
(function() {
    RED.nodes.registerType('Barcode Decoder', {
        category: 'image tools',
        paletteLabel: "Barcode Decoder",
        //labelStyle: "node-label-white",
        icon: "qrcode.png",
        color: '#FFAAAA',//'#f24b69',
        defaults: {
            name: { value: "" },
            data: { value: "payload", validate: RED.validators.typedInput("dataType") },
            dataType: { value: "msg" },
            specification: { value: '{format : ["QR", "DATA_MATRIX"], tryHarder: true}', validate: RED.validators.typedInput("specificationType") },
            specificationType: { value: "json" },
        },
        inputs: 1,
        outputs: 1,
        label: function () {
            return this.name || "Barcode Decoder";
        },
        oneditprepare: function () {
            let node = this;
            debugger
            function setupTypedInput(varName, types, def) {
                let varSel = '#node-input-' + varName;
                let typeSel = varSel + 'Type';
                let varVal = node[varName];
                let typeVal = node[varName + 'Type'];

                if (typeVal == null || typeVal === 'none') {
                    typeVal = def;
                } else if (typeVal === 'string') {
                    typeVal = "str";
                } else if (typeVal === 'number') {
                    typeVal = "num";
                }
                $(typeSel).val(typeVal);
                $(varSel).typedInput({
                    default: def,
                    typeField: $(typeSel),
                    types: types
                });
                $(varSel).typedInput('type', typeVal);
            }

            setupTypedInput('data', ['msg', 'flow', 'global', 'bin', 'str'], 'str');
            setupTypedInput('specification', ['msg', 'flow', 'global', 'json'], 'json');
        }
    });
})();    
</script>

<script type="text/html" data-template-name="Barcode Decoder">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-data"><i class="fa fa-file-image-o"></i><span data-i18n="xzingDecode.label.data"> image</span></label>
        <input type="hidden" id="node-input-dataType">
        <input style="width: 70%" type="text" id="node-input-data" placeholder="image.jpg">
    </div>
    <div class="form-row">
        <label for="node-input-specification"><i class="fa fa-code"></i><span data-i18n="xzingDecode.label.specification"> specification</span></label>
        <input type="hidden" id="node-input-specificationType">
        <input style="width: 70%" type="text" id="node-input-specification" placeholder="{QR: true, dataMatrix: false, tryHarder: true}">
    </div>
 
</script>

<script type="text/html" data-help-name="Barcode Decoder">
<p>A barcode decoder node built with zxing and Jimp</p>

<h3>Inputs</h3>
<dl class="message-properties">
    <dt>image <span class="property-type">string | base64 | buffer</span></dt>
    <dd> the file (buffer / base64 string) or file name to be processed. </dd>
    <dt>specification <span class="property-type">string | JSON</span></dt>
    <dd> the specification to use when decoding the barcode in the image</dd>
    Specification Example to read QR only...
    <code>
        {format: ["QR_CODE"], "tryHarder": true}
    </code>
    Specification Example to read Datamatrix only...
    <code>
        {format: ["DATA_MATRIX"], "tryHarder": true}
    </code>
    Specification Example to read 3 different type of barcode...
    <code>
        {format: ["EAN_32", "RSS_14", "ITF"], "tryHarder": true}
    </code>
    <b>To see all currently supported types, import the example "Barcodes" or refer <a target="_blank" href="https://github.com/zxing-js/library#supported-formats">supported-formats</a> 
</dl>
<h3>Output</h3>
<dl class="message-properties">
    <dt>payload <span class="property-type">object</span></dt>
    <dd>The results.</dd>
    <dt>performance <span class="property-type">object</span></dt>
    <dd>Performance measurements of the image loading and processing</dd>
    <h4>Additional useful properties are available in the <code>msg</code> object. Use a debug node to inspect them</h4>
</dl>

</script>